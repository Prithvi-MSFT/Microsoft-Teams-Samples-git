# Docs for the Azure Web Apps Deploy action: https://github.com/Azure/webapps-deploy
# More GitHub Actions for Azure: https://github.com/Azure/actions

name: Build - All Samples
on:
  push:
    #Change the branch name to <<main>>
    #Change the path to the folder where your code resides. Any change here will start the activity. 
    branches:
      - v-abt/sample-health-build
    paths:
      - 'samples/app-installation-using-qr-code/csharp/**'  
  schedule:
    - cron: '12 21 * * *'  # every day at midnight
env:
    PROJECT_PATH_APP_VIRTUAL_ASSISTANT_CSHARP: ''

jobs:
  build-csharp-samples:
    runs-on: windows-latest
    strategy:
      matrix:
        include:
            - project_path: 'samples/app-region-selection/csharp/RegionSectionApp/RegionSelectionApp.csproj'
              name: 'app-region-selection'
              version: '3.1.301'

            - project_path: 'samples/meetings-sidepanel/csharp/Side Panel/SidePanel.csproj'
              name: 'meetings-sidepanel'
              version: '3.1.301'

            - project_path: 'samples/msgext-message-reminder/csharp/MessagingExtensionReminder/MessagingExtensionReminder.csproj'
              name: 'msgext-message-reminder'
              version: '3.1.301'

            - project_path: 'samples/tab-adaptive-cards/csharp/TabWithAdpativeCardFlow/TabWithAdpativeCardFlow.csproj'
              name: 'tab-adaptive-cards'
              version: '3.1.301'

            - project_path: 'samples/tab-channel-group-config-page-auth/csharp/TabAuthentication/TabAuthentication.csproj'
              name: 'tab-channel-group-config-page-auth'
              version: '3.1.301'

            - project_path: 'samples/tab-conversations/csharp/TabConversation/TabConversation.csproj'
              name: 'tab-conversations'
              version: '3.1.301'

            - project_path: 'samples/tab-deeplink/csharp/DeepLinkBot/DeepLinkBot.csproj'
              name: 'tab-deeplink'
              version: '3.1.301'

            - project_path: 'samples/tab-graph-toolkit/csharp/TabGraphToolkit/TabGraphToolkit.csproj'
              name: 'tab-graph-toolkit'
              version: '3.1.301'

            - project_path: 'samples/tab-product-inspection/csharp/ProductInspection/ProductInspection.csproj'
              name: 'tab-product-inspection'
              version: '3.1.301'

            - project_path: 'samples/tab-request-approval/csharp/TabRequestApproval/TabRequestApproval.csproj'
              name: 'tab-request-approval'
              version: '3.1.301'

            - project_path: 'samples/tab-sso/csharp/TeamsTabSSO/TeamsTabSSO.csproj'
              name: 'tab-sso'
              version: '3.1.301'

            - project_path: 'samples/tab-stage-view/csharp/TabInStageView/TabInStageView.csproj'
              name: 'tab-stage-view'
              version: '3.1.301'

            - project_path: 'samples/tab-staggered-permission/csharp/StaggeredPermission/StaggeredPermission.csproj'
              name: 'tab-staggered-permission'
              version: '3.1.301'

      fail-fast: false
    name: Build "${{ matrix.name }}" csharp
    steps:
      - uses: actions/checkout@v2

      - name: Set up .NET Core
        uses: actions/setup-dotnet@v1
        with:
          dotnet-version: "${{ matrix.version }}"
          include-prerelease: true

      - name: Build app
        run: dotnet build "${{ matrix.project_path }}" --configuration Release

  build-dotnet-samples:
    runs-on: windows-latest
    strategy:
      matrix:
        include:
            - project_path: 'samples/app-complete-sample/csharp/template-bot-master-csharp/template-bot-master-csharp.csproj'
              name: 'app-complete-sample'

            - project_path: 'samples/app-task-module/csharp/Microsoft.Teams.Samples.TaskModule.Web/Microsoft.Teams.Samples.TaskModule.Web.csproj'
              name: 'app-task-module'

      fail-fast: false
    name: Build "${{ matrix.name }}" csharp
    steps:
      - name: Add msbuild to PATH
        uses: microsoft/setup-msbuild@v1.1

      - name: Build app
        run: msbuild ${{ matrix.project_path }}" -t:rebuild -verbosity:diag -property:Configuration=Release

  build-nodejs-samples:
    runs-on: windows-latest
    strategy:
      matrix:
        include:
            - project_path: 'samples/meeting-recruitment-app/nodejs/api'
              name: 'meeting-recruitment-app'
              version: '14.x'

            - project_path: 'samples/meetings-details-tab/nodejs/api'
              name: 'meetings-details-tab'
              version: '14.x'

            - project_path: 'samples/meetings-live-code-interview/nodejs'
              name: 'meetings-live-code-interview'
              version: '14.x'
        
            - project_path: 'samples/msgext-message-reminder/nodejs'
              name: 'msgext-message-reminder'
              version: '14.x'

            - project_path: 'samples/msgext-search-sso-config/nodejs'
              name: 'msgext-search-sso-config'
              version: '14.x'

            - project_path: 'samples/tab-adaptive-cards/nodejs'
              name: 'tab-adaptive-cards'
              version: '14.x'

            - project_path: 'samples/tab-conversations/nodejs'
              name: 'tab-conversations'
              version: '14.x'

            - project_path: 'samples/tab-deeplink/nodejs'
              name: 'tab-deeplink'
              version: '14.x'

            - project_path: 'samples/tab-device-permissions/nodejs'
              name: 'tab-device-permissions'
              version: '14.x'

            - project_path: 'samples/tab-product-inspection/nodejs'
              name: 'tab-product-inspection'
              version: '14.x'

            - project_path: 'samples/tab-request-approval/nodejs'
              name: 'tab-request-approval'
              version: '14.x'

            - project_path: 'samples/tab-sso/nodejs'
              name: 'tab-sso'
              version: '14.x'

            - project_path: 'samples/tab-stage-view/nodejs'
              name: 'tab-stage-view'
              version: '14.x'

            - project_path: 'samples/tab-staggered-permission/nodejs'
              name: 'tab-staggered-permission'
              version: '14.x'

      fail-fast: false
    name: Build "${{ matrix.name }}" nodejs
    defaults:
      run:
        working-directory: "${{ matrix.project_path }}"
    steps:
      - uses: actions/checkout@v2

      - name: Set up Node.js version
        uses: actions/setup-node@v1
        with:
          node-version: "${{ matrix.version }}"

      - name: npm install, build, and test
        run: |
          npm install
          npm run build --if-present
    
