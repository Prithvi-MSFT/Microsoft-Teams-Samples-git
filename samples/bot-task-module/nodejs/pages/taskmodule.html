<!-- //- Copyright (c) Microsoft Corporation
//- All rights reserved. -->
<head>
  <script src="https://res.cdn.office.net/teams-js/2.0.0/js/MicrosoftTeams.min.js"
    integrity="sha384-QtTBFeFlfRDZBfwHJHYQp7MdLJ2C3sfAEB1Qpy+YblvjavBye+q87TELpTnvlXw4"
    crossorigin="anonymous"></script>
  </style>
</head>

<body>
  <div class="font-semibold font-title">Microsoft Teams Task Modules Demo</div>
  <p>A task module allows Teams app developers to create one or more custom, modal experiences with custom code or <a
      src="https://adaptivecards.io">Adaptive cards</a> for their users, particularly useful for initiating and/or
    completing tasks using a GUI that does not litter a Teams conversation with superfluous, intermediate task
    completion
    information.</p>
  <p>Let's try it out!
  <div id="buttons" style="text-align: center; margin-left: auto; margin-right: auto">
    <button class="taskModuleButton button-primary" id="YouTube">YouTube</button>
    <p></p>
    <button class="taskModuleButton button-primary" id="PowerApp">PowerApp</button>
    <p></p>
    <button class="taskModuleButton button-primary" id="customform">Custom Form</button>
    <pre id="customFormResults" style="white-space: pre-wrap; display: none"></pre>
    <p></p>
    <button class="taskModuleButton button-primary" id="adaptivecard1">Adaptive Card</button>
    <pre id="adaptiveResults" style="white-space: pre-wrap; display: none"></pre>
    <p></p>
    <p></p>
    <div><a id="deeplink" target="_blank" )>Deep Link</a></div>
  </div>
  <script>
    microsoftTeams.app.initialize();
    var taskModuleButtons = document.getElementsByClassName("taskModuleButton");
    if (taskModuleButtons.length > 0) {

      var taskInfo_1 = {
        title: "",
        height: "",
        width: "",
        url: "",
        card: "",
        fallbackUrl: "",
        completionBotId: ""
      };

      var TaskModuleIds = {
        YouTube: "youtube",
        PowerApp: "powerapp",
        CustomForm: "customform",
        AdaptiveCard1: "adaptivecard1",
        AdaptiveCard2: "adaptivecard2"
      };

      var DeelplinkIds = {
        YouTube: "youtube.html",
        PowerApp: "powerapp.html",
        CustomForm: "customform.html",
        AdaptiveCard1: "adaptivecard1",
        AdaptiveCard2: "adaptivecard2"
      };

      var TaskModuleStrings = {
        YouTubeTitle: "Microsoft Ignite 2018 Vision Keynote",
        PowerAppTitle: "PowerApp: Asset Checkout",
        CustomFormTitle: "Custom Form",
        AdaptiveCardTitle: "Create a new job posting",
        AdaptiveCardKitchenSinkTitle: "Adaptive Card: Inputs",
        ActionSubmitResponseTitle: "Action.Submit Response",
        YouTubeName: "YouTube",
        PowerAppName: "PowerApp",
        CustomFormName: "Custom Form",
        AdaptiveCardSingleName: "Adaptive Card - Single",
        AdaptiveCardSequenceName: "Adaptive Card - Sequence"
      };

      var config = {
        MicrosoftAppID: "<<Microsoft-App-ID>>",
        BaseUrl: "https://<<Valid-Domain>>"
      }

      var TaskModuleSizes = {
        youtube: {
          width: 1000,
          height: 700
        },
        powerapp: {
          width: 720,
          height: 520
        },
        customform: {
          width: 510,
          height: 430
        },
        adaptivecard: {
          width: 700,
          height: 255
        }
      };

      //Initilize Deeplink
      var deepLink = document.getElementById("deeplink");
      deepLink.href = "https://teams.microsoft.com/l/task/" + config.MicrosoftAppID + "?url=" + "".concat((0, appRoot)(), "/").concat(DeelplinkIds.CustomForm + "&height=" + TaskModuleSizes.customform.height + "&width=" + TaskModuleSizes.customform.width + "&title=" + TaskModuleStrings.CustomFormTitle + "&completionBotId=" + config.MicrosoftAppID);

      function appRoot() {
        if (typeof window === "undefined") {
          return config.BaseUrl;
        }
        else {
          return window.location.protocol + "//" + window.location.host;
        }
      }

      var adaptiveCard_template = {
        "type": "AdaptiveCard",
        "body": [
          {
            "type": "TextBlock",
            "separator": true,
            "size": "Large",
            "weight": "Bolder",
            "text": "Enter basic information for this position:",
            "isSubtle": true,
            "wrap": true
          },
          {
            "type": "TextBlock",
            "separator": true,
            "text": "Title",
            "wrap": true
          },
          {
            "type": "Input.Text",
            "id": "jobTitle",
            "placeholder": "E.g. Senior PM"
          },
          {
            "type": "ColumnSet",
            "columns": [
              {
                "type": "Column",
                "items": [
                  {
                    "type": "TextBlock",
                    "text": "Level",
                    "wrap": true
                  },
                  {
                    "type": "Input.Number",
                    "id": "jobLevel",
                    "value": "7",
                    "placeholder": "Level in numbers min **1** and max **10**",
                    "min": 1,
                    "max": 10
                  }
                ],
                "width": 2
              },
              {
                "type": "Column",
                "items": [
                  {
                    "type": "TextBlock",
                    "text": "Location"
                  },
                  {
                    "type": "Input.ChoiceSet",
                    "id": "jobLocation",
                    "value": "1",
                    "choices": [
                      {
                        "title": "San Francisco",
                        "value": "1"
                      },
                      {
                        "title": "London",
                        "value": "2"
                      },
                      {
                        "title": "Singapore",
                        "value": "3"
                      },
                      {
                        "title": "Dubai",
                        "value": "3"
                      },
                      {
                        "title": "Frankfurt",
                        "value": "3"
                      }
                    ],
                    "isCompact": true
                  }
                ],
                "width": 2
              }
            ]
          }
        ],
        "actions": [
          {
            "type": "Action.Submit",
            "id": "createPosting",
            "title": "Create posting",
            "data": {
              "command": "createPosting",
              "taskResponse": "{{responseType}}"
            }
          },
          {
            "type": "Action.Submit",
            "id": "cancel",
            "title": "Cancel"
          }
        ],
        "version": "1.0"
      }

      for (var _i = 0, taskModuleButtons_1 = taskModuleButtons; _i < taskModuleButtons_1.length; _i++) {
        var btn = taskModuleButtons_1[_i];
        btn.addEventListener("click", function () {
          // Hide customFormResults, adaptiveResults
          var customFormResults = document.getElementById("customFormResults");
          customFormResults.style.display = "none";
          var adaptiveResults = document.getElementById("adaptiveResults");
          adaptiveResults.style.display = "none";
          taskInfo_1.url = "".concat((0, appRoot)(), "/").concat(this.id.toLowerCase(), ".html");
          // Define default submitHandler()
          var submitHandler = function (err, result) { console.log("Err: ".concat(err, "; Result:  + ").concat(result)); };
          switch (this.id.toLowerCase()) {

            case TaskModuleIds.YouTube:
              taskInfo_1.title = TaskModuleStrings.YouTubeTitle;
              taskInfo_1.size = { height: 7000, width: 1000 };
              microsoftTeams.dialog.open(taskInfo_1, submitHandler);
              break;
            case TaskModuleIds.PowerApp:
              taskInfo_1.title = TaskModuleStrings.PowerAppTitle;
              taskInfo_1.size = { height: TaskModuleSizes.powerapp.height, width: TaskModuleSizes.powerapp.width };
              microsoftTeams.dialog.open(taskInfo_1, submitHandler);
              break;
            case TaskModuleIds.CustomForm:
              taskInfo_1.title = TaskModuleStrings.CustomFormTitle;
              taskInfo_1.size = { height: TaskModuleSizes.customform.height, width: TaskModuleSizes.customform.width };
              submitHandler = (err, result) => {
                console.log(`Submit handler - err: ${err}`);
                console.log(`Submit handler - result\rName: ${result.name}\rEmail: ${result.email}\rFavorite book: ${result.favoriteBook}`);
              };
              microsoftTeams.dialog.open(taskInfo_1, submitHandler);
              break;
            case TaskModuleIds.AdaptiveCard1:
              taskInfo_1.title = TaskModuleStrings.AdaptiveCardTitle;
              taskInfo_1.url = "";
              taskInfo_1.size = { height: TaskModuleSizes.powerapp.height, width: TaskModuleSizes.powerapp.width };
              taskInfo_1.card = adaptiveCard_template;
              var resultsElement = document.getElementById("adaptiveResults");
              submitHandler = (err, result) => {
                console.log(`Submit handler - err: ${err}`);
                console.log(
                  "Result = " + JSON.stringify(result) + "\nError = " + JSON.stringify(err)
                );
              };
              microsoftTeams.tasks.startTask(taskInfo_1, submitHandler);
              break;
            default:
              console.log("Unexpected button ID: " + this.id.toLowerCase());
              return;
          }
          console.log("URL: " + taskInfo_1.url);
        });
      }
    }
  </script>
</body>